<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Cocktail Share</title>
		<!-- Required meta tags -->
		<meta charset="utf-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1, shrink-to-fit=no"
		/>
		<link rel="stylesheet" href="style.css" />
		<!-- Bootstrap CSS -->
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;400;500;700&display=swap"
			rel="stylesheet"
		/>
		<link
			rel="stylesheet"
			href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
			integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
			crossorigin="anonymous"
		/>
	</head>
	<body>
		<nav id="navbar" class="navbar sticky-top navbar-expand-sm navbar-dark bg-dark">
        <a class="navbar-brand" href="/">BarJournal</a>
        <button class="navbar-toggler d-lg-none" type="button" data-toggle="collapse" data-target="#collapsibleNavId" aria-controls="collapsibleNavId"
            aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="collapsibleNavId">
            <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
                <li class="nav-item">
                    <a class="nav-link" href="/">Home <span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">My Cocktails</a>
                </li>
                <li class="nav-item dropdown active">
                    <a class="nav-link dropdown-toggle" href="#" id="dropdownId" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Add New</a>
                    <div class="dropdown-menu" aria-labelledby="dropdownId">
                        <a class="dropdown-item active" href="/new-cocktail">Cocktail</a>
                        <a class="dropdown-item" href="/new-ingredient">Ingredient</a>
                    </div>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="dropdownId" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">GET Requests</a>
                    <div class="dropdown-menu" aria-labelledby="dropdownId">
                        <a class="dropdown-item" href="/cocktails">Cocktails</a>
                        <a class="dropdown-item" href="/ingredients">Ingredients</a>
                    </div>
                </li>
            </ul>
			<ul class="navbar-nav ml-auto mt-2 mt-lg-0">
				<li class="nav-item ml-auto">
                    <a class="nav-link" href="/logout">Logout <span class="sr-only">(current)</span></a>
                </li>
			</ul>
        </div>
    </nav>
		<div class="main-screen">
			<div class="container-fluid">
				<div id="wrapper" class="row">
					<div id="container" class="col-lg-6 p-3" >
						<h1>Create New Cocktail</h1>
						<div id="form" style="display:" >
							<div class="input-group mb-3">
								<div class="input-group-prepend">
									<span
										class="input-group-text"
										id="inputGroup-sizing-default"
										>Drink Name</span
									>
								</div>
								<input
									id="drink-name"
									type="text"
									class="form-control col"
									aria-label="Default"
									aria-describedby="inputGroup-sizing-default"
								/>
								<br>
							</div>
							<div id="name-error" class="text-danger m-3"></div>
							<div class="input-group mb-3">
								<div class="input-group-prepend">
									<span
									class="input-group-text"
									id="inputGroup-sizing-default"
									>Image URL</span
									>
								</div>
								<input
								id="img-url"
								type="text"
								class="form-control"
								aria-label="Default"
								aria-describedby="inputGroup-sizing-default"
								/>
							</div>
							<div class="input-group mb-3">
								<div class="input-group-prepend">
									<label
									class="input-group-text"
									for="inputGroupSelect01"
									>Spirit</label
									>
								</div>
								<select class="custom-select" id="spirit">
									<option value=NULL  selected>Choose...</option>
									${ ingredients.map(ingredient => { return `
										<option value=${ingredient.id}>
											${ingredient.name}
										</option>
										` }).join('') }
									</select>
									<input type="text" class="form-control"id="spirit-amount" />
									<div class="input-group-append">
										<span class="input-group-text" id="basic-addon2"
										>oz</span
										>
									</div>
								</div>
								<div id="spirit-error" class="text-danger m-3"></div>
								<div class="input-group mb-3">
									<div class="input-group-prepend">
										<label
										class="input-group-text"
										for="inputGroupSelect01"
										>Citrus</label
									>
								</div>
								<select class="custom-select" id="citrus">
									<option value=NULL selected>Choose...</option>
									${ ingredients.map(ingredient => { return `
									<option value=${ingredient.id}>
										${ingredient.name}
									</option>` }).join('') }
								</select>
								<input type="text" class="form-control" id="citrus-amount" />
								<div class="input-group-append">
									<span class="input-group-text" id="basic-addon2"
										>oz</span
									>
								</div>
							</div>
							<div class="input-group mb-3">
								<div class="input-group-prepend">
									<label
										class="input-group-text"
										for="inputGroupSelect01"
										>Sweetener</label
									>
								</div>
								<select class="custom-select" id="sweetener">
									<option value=NULL selected>Choose...</option>
									${ ingredients.map(ingredient => { return `
									<option value=${ingredient.id}>
										${ingredient.name}
									</option>` }).join('') }
								</select>
								<input type="text" class="form-control" id="sweetener-amount"/>
								<div class="input-group-append">
									<span class="input-group-text" id="basic-addon2"
										>oz</span
									>
								</div>
							</div>
							<div class="input-group mb-3">
								<div class="input-group-prepend">
									<label
										class="input-group-text"
										for="inputGroupSelect01"
										>Shake</label
									>
								</div>
								<select class="custom-select" id="shake">
									<option value=NULL selected>Choose...</option>
									<option value="Hard Shake">Hard Shake</option>
									<option value="Quick Shake">Quick Shake</option>
									<option value="Whip Shake">Whip Shake</option>
									<option value="Stirred">Stirred</option>
								</select>
							</div>
							<div class="form-group">
								<label for="description"
									>Description</label
								>
								<textarea
									class="form-control"
									id="description"
									rows="3"
								></textarea>
							</div>
							<div id="description-error" class="text-danger m-3"></div>
							<a
								href="/new-ingredient"
								role="button"
								class="btn-primary btn btn-block"
							>
								Click to add new Ingredient
							</a>

							<button
								id="submit-btn"
								class="btn-success btn btn-block"
							>
								Submit
							</button>
							</div>

						<div id="success" class="m-4 ml-5" style="display:none">
							<p class="text-success">Drink added successfully!</p>
						</div>
					</div>
				</div>
			</div>
		</div>

		<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
		<script>
			const submit = document.getElementById("submit-btn");
			submit.addEventListener("click", async () => {
				// Reset error messages
				document.getElementById('name-error').innerText = '';
				document.getElementById('spirit-error').innerText = '';
				document.getElementById('description-error').innerText = '';
				let citrus = null;
				let sweetener = null;
				let shake = null;
				if (document.getElementById("citrus").value != "NULL") {
					citrus = document.getElementById("citrus").value
				}
				if (document.getElementById("sweetener").value != "NULL") {
					sweetener = document.getElementById("sweetener").value
				}
				if (document.getElementById("shake").value != 'NULL') {
					shake = document.getElementById("sweetener").value
				}

				// Get details from form
				const newCocktail = {
					name: document.getElementById("drink-name").value,
					spirit: document.getElementById("spirit").value,
					citrus: citrus,
					sweetener: sweetener,
					shake: shake,
					description: document.getElementById('description').value,
					url: document.getElementById('img-url').value,
					spiritAmount: document.getElementById("spirit-amount").value,
					citrusAmount: document.getElementById("citrus-amount").value,
					sweetenerAmount: document.getElementById("sweetener-amount").value,
					
				};
				// Check if cocktail exists under that name already 
				let alreadyExists; 
				await axios('/cocktails').then((res)=> {
					res.data.find((cocktail)=> {
						if (cocktail.name == newCocktail.name){
							alreadyExists = true;
						}
					})
				})
				if (alreadyExists == true) {
					document.getElementById('name-error').innerText = 'A cocktail already exists under this name!'
					return ;
				} else {
				
				// Check if name field is filled out
				if (!newCocktail.name ) {
					document.getElementById('name-error').innerText = 'This field must be filled out';
				}
				
				// Check if spirit field is filled out
				if (!newCocktail.spirit || !newCocktail.spiritAmount ) {
					document.getElementById('spirit-error').innerText = 'This field must be filled out';
				}

				// Check if description is filled out
				if (!newCocktail.description ) {
					document.getElementById('description-error').innerText = 'This field must be filled out';
				}

				// Don't post data if required fields are empty
				if (newCocktail.name == '' || newCocktail.spirit== '' || newCocktail.description== '' || newCocktail.spiritAmount== '') {
					console.log("INVALID ENTRY");
					return;
				}
				
				document.getElementById('form').style.display ='none';
				document.getElementById('success').style.display ='';
				await axios.post("/cocktails", newCocktail)
				

				}
				
			});
		</script>
		<script></script>
		<!-- Optional JavaScript -->
		<!-- jQuery first, then Popper.js, then Bootstrap JS -->

		<script
			src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
			integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
			crossorigin="anonymous"
		></script>
		<script
			src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
			integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
			crossorigin="anonymous"
		></script>
		<script
			src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
			integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
			crossorigin="anonymous"
		></script>
	</body>
</html>
